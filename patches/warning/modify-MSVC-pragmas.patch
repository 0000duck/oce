From e46cfb98b6513a040387a93bfb8269a359d2bc76 Mon Sep 17 00:00:00 2001
From: QbProg <tholag@gmail.com>
Date: Sun, 24 Jul 2011 17:54:00 +0200
Subject: [PATCH 01/11] [warning-fix] MSVC pragmas

Removed many MSVC warning pragmas, that previously hide some possible warning fixes.
Corrected some others to be disabled instead of level 4 (actually used to do the fixes)
---
 drv/ShapeSchema/ShapeSchema.cxx                    |    5 +++++
 drv/StdLSchema/StdLSchema.cxx                      |    5 +++++
 drv/StdSchema/StdSchema.cxx                        |    5 +++++
 drv/XCAFSchema/XCAFSchema.cxx                      |    5 +++++
 src/BOPTools/BOPTools_PaveSet.cxx                  |    7 +------
 src/BinDrivers/BinDrivers.cxx                      |    2 +-
 src/BinLDrivers/BinLDrivers.cxx                    |    2 +-
 src/BinTObjDrivers/BinTObjDrivers.cxx              |    2 +-
 src/BinXCAFDrivers/BinXCAFDrivers.cxx              |    2 +-
 .../BooleanOperations_ShapesDataStructure.cxx      |   10 ----------
 src/FWOSDriver/FWOSDriver.cxx                      |    2 +-
 src/IntTools/IntTools.cxx                          |    7 -------
 src/IntTools/IntTools_EdgeFace.cxx                 |    8 --------
 src/LDOM/LDOM_BasicAttribute.cxx                   |    5 -----
 src/LDOM/LDOM_BasicElement.cxx                     |    5 -----
 src/LDOM/LDOM_BasicText.cxx                        |    5 -----
 src/OSD/OSD_Environment.cxx                        |    4 ----
 src/OSD/OSD_Process.cxx                            |    4 ----
 src/PlotMgt/PlotMgt_TextManager.cxx                |    4 ----
 src/Poly/Poly_CoherentNode.cxx                     |    4 ----
 src/Poly/Poly_CoherentTriPtr.cxx                   |    4 ----
 src/StdDrivers/StdDrivers.cxx                      |    2 +-
 src/StdLDrivers/StdLDrivers.cxx                    |    2 +-
 src/TDF/TDF_Data.cxx                               |    9 ---------
 src/TDF/TDF_Label.cxx                              |    9 ---------
 src/TopExp/TopExp_Explorer.cxx                     |    8 --------
 src/ViewerTest/ViewerTest.cxx                      |    1 -
 src/ViewerTest/ViewerTest_ObjectCommands.cxx       |    1 -
 src/ViewerTest/ViewerTest_ViewerCommands.cxx       |    1 -
 src/VrmlData/VrmlData_Geometry.cxx                 |    1 -
 src/VrmlData/VrmlData_Group.cxx                    |    1 -
 src/VrmlData/VrmlData_IndexedFaceSet.cxx           |    1 -
 src/VrmlData/VrmlData_IndexedLineSet.cxx           |    1 -
 src/VrmlData/VrmlData_Material.cxx                 |    1 -
 src/VrmlData/VrmlData_Node.cxx                     |    1 -
 src/VrmlData/VrmlData_Scene.cxx                    |    1 -
 src/VrmlData/VrmlData_WorldInfo.cxx                |    1 -
 src/XCAFDrivers/XCAFDrivers.cxx                    |    2 +-
 src/XmlDrivers/XmlDrivers.cxx                      |    2 +-
 src/XmlLDrivers/XmlLDrivers.cxx                    |    2 +-
 src/XmlTObjDrivers/XmlTObjDrivers.cxx              |    2 +-
 src/XmlXCAFDrivers/XmlXCAFDrivers.cxx              |    2 +-
 42 files changed, 33 insertions(+), 115 deletions(-)

From 1bfed73424019d8e17502623c94ea06bac4cbf7a Mon Sep 17 00:00:00 2001
From: salajkav-dlubalcz <vojtech.salajka@dlubal.cz>
Date: Wed, 12 Sep 2012 09:48:31 +0200
Subject: [PATCH 1/4] MinGW32 compatibility fixes.

---
 inc/Standard_Atomic.hxx |    4 ++--
 src/OSD/OSD_MemInfo.cxx |    4 ++++
 2 files changed, 6 insertions(+), 2 deletions(-)

From 119d575b5b78b7b57196755cd50ae581ef03a191 Mon Sep 17 00:00:00 2001
From: salajkav-dlubalcz <vojtech.salajka@dlubal.cz>
Date: Wed, 12 Sep 2012 11:22:32 +0200
Subject: [PATCH 2/4] Source code simplification.

---
 inc/Standard_Atomic.hxx |   37 +++++++++++++++++--------------------
 1 file changed, 17 insertions(+), 20 deletions(-)

From 6eb52d540227e3fddfcab5009306adb3399c9442 Mon Sep 17 00:00:00 2001
From: salajkav-dlubalcz <vojtech.salajka@dlubal.cz>
Date: Wed, 12 Sep 2012 11:26:38 +0200
Subject: [PATCH 3/4] Tab/Space fix.

---
 inc/Standard_Atomic.hxx |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

From 907cea25e7b538e9ee1fc084f3e25bbab032b619 Mon Sep 17 00:00:00 2001
From: Denis Barbier <bouzim@gmail.com>
Date: Fri, 28 Sep 2012 09:00:01 +0200
Subject: [PATCH 4/4] Cosmetics: rearrange Standard_Atomic.hxx to minimize
 diff against OCCT

Remove trailing whitespace in OSD_MemInfo.cxx.
---
 inc/Standard_Atomic.hxx |    9 ++++++---
 src/OSD/OSD_MemInfo.cxx |    4 ++--
 2 files changed, 8 insertions(+), 5 deletions(-)

Index: oce/drv/ShapeSchema/ShapeSchema.cxx
===================================================================
--- oce.orig/drv/ShapeSchema/ShapeSchema.cxx
+++ oce/drv/ShapeSchema/ShapeSchema.cxx
@@ -518,6 +518,11 @@
 #include <ShapeSchema_PCollection_HExtendedString.hxx>
 #endif
 
+// avoid warnings on 'extern "C"' functions returning C++ classes
+#ifdef _MSC_VER
+#pragma warning(disable:4190)
+#endif
+
 IMPLEMENT_STANDARD_HANDLE(ShapeSchema,Storage_Schema)
 IMPLEMENT_STANDARD_RTTIEXT(ShapeSchema,Storage_Schema)
 
Index: oce/drv/StdLSchema/StdLSchema.cxx
===================================================================
--- oce.orig/drv/StdLSchema/StdLSchema.cxx
+++ oce/drv/StdLSchema/StdLSchema.cxx
@@ -161,6 +161,11 @@
 #include <StdLSchema_PColStd_HArray2OfInteger.hxx>
 #endif
 
+// avoid warnings on 'extern "C"' functions returning C++ classes
+#ifdef _MSC_VER
+#pragma warning(disable:4190)
+#endif
+
 IMPLEMENT_STANDARD_HANDLE(StdLSchema,Storage_Schema)
 IMPLEMENT_STANDARD_RTTIEXT(StdLSchema,Storage_Schema)
 
Index: oce/drv/StdSchema/StdSchema.cxx
===================================================================
--- oce.orig/drv/StdSchema/StdSchema.cxx
+++ oce/drv/StdSchema/StdSchema.cxx
@@ -101,6 +101,11 @@
 #include <StdSchema_PTopLoc_ItemLocation.hxx>
 #endif
 
+// avoid warnings on 'extern "C"' functions returning C++ classes
+#ifdef _MSC_VER
+#pragma warning(disable:4190)
+#endif
+
 IMPLEMENT_STANDARD_HANDLE(StdSchema,Storage_Schema)
 IMPLEMENT_STANDARD_RTTIEXT(StdSchema,Storage_Schema)
 
Index: oce/drv/XCAFSchema/XCAFSchema.cxx
===================================================================
--- oce.orig/drv/XCAFSchema/XCAFSchema.cxx
+++ oce/drv/XCAFSchema/XCAFSchema.cxx
@@ -83,6 +83,11 @@
 #include <XCAFSchema_PCollection_HExtendedString.hxx>
 #endif
 
+// avoid warnings on 'extern "C"' functions returning C++ classes
+#ifdef _MSC_VER
+#pragma warning(disable:4190)
+#endif
+
 IMPLEMENT_STANDARD_HANDLE(XCAFSchema,Storage_Schema)
 IMPLEMENT_STANDARD_RTTIEXT(XCAFSchema,Storage_Schema)
 
Index: oce/src/BOPDS/BOPDS_PassKey.cxx
===================================================================
--- oce.orig/src/BOPDS/BOPDS_PassKey.cxx
+++ oce/src/BOPDS/BOPDS_PassKey.cxx
@@ -19,7 +19,7 @@
 
 #include <stdio.h>
 
-#ifdef WNT
+#ifdef _MSC_VER
 #pragma warning( disable : 4101) 
 #endif
 
Index: oce/src/BOPDS/BOPDS_PaveBlock.cxx
===================================================================
--- oce.orig/src/BOPDS/BOPDS_PaveBlock.cxx
+++ oce/src/BOPDS/BOPDS_PaveBlock.cxx
@@ -18,7 +18,7 @@
 #include <NCollection_BaseAllocator.hxx>
 
 
-#ifdef WNT
+#ifdef _MSC_VER
 #pragma warning ( disable : 4291 )
 #endif
 
Index: oce/src/IntTools/IntTools.cxx
===================================================================
--- oce.orig/src/IntTools/IntTools.cxx
+++ oce/src/IntTools/IntTools.cxx
@@ -32,9 +32,6 @@
 #include <TColStd_ListIteratorOfListOfReal.hxx>
 #include <gce_ErrorType.hxx>
 
-#ifdef _MSC_VER
-#pragma warning ( disable : 4101 )
-#endif
 //=======================================================================
 //function : IntTools::GetRadius
 //purpose  : 
@@ -370,7 +367,3 @@
   }
   return 1;
 }
-
-#ifdef _MSC_VER
-#pragma warning ( default : 4101 )
-#endif
Index: oce/src/IntTools/IntTools_EdgeFace.cxx
===================================================================
--- oce.orig/src/IntTools/IntTools_EdgeFace.cxx
+++ oce/src/IntTools/IntTools_EdgeFace.cxx
@@ -64,10 +64,6 @@
 #include <GeomAdaptor_HSurface.hxx>
 #include <IntCurveSurface_IntersectionPoint.hxx>
 
-#ifdef _MSC_VER
-#pragma warning ( disable : 4101 )
-#endif
-
 static
   Standard_Boolean IsCoplanar (const BRepAdaptor_Curve&  ,
 			       const BRepAdaptor_Surface& );
@@ -1537,7 +1533,3 @@ Standard_Integer AdaptiveDiscret (const
   return iDiscretNew;
 }
 
-
-#ifdef _MSC_VER
-#pragma warning ( default : 4101 )
-#endif
Index: oce/src/OSD/OSD_Environment.cxx
===================================================================
--- oce.orig/src/OSD/OSD_Environment.cxx
+++ oce/src/OSD/OSD_Environment.cxx
@@ -240,10 +240,6 @@ Standard_Integer OSD_Environment::Error(
 
 #include <stdio.h>
 
-#ifdef _MSC_VER
-#pragma warning( disable : 4700 )
-#endif
-
 static void __fastcall _set_error ( OSD_Error&, DWORD );
 
 OSD_Environment :: OSD_Environment () {
Index: oce/src/OSD/OSD_File.cxx
===================================================================
--- oce.orig/src/OSD/OSD_File.cxx
+++ oce/src/OSD/OSD_File.cxx
@@ -855,8 +855,10 @@ Standard_Boolean OSD_File::IsExecutable(
 #define _int64 int64_t
 #endif
 
+#ifdef _MSC_VER
 #pragma comment( lib, "WSOCK32.LIB"  )
 #pragma comment( lib, "WINSPOOL.LIB" )
+#endif
 
 #define ACE_HEADER_SIZE (  sizeof ( ACCESS_ALLOWED_ACE ) - sizeof ( DWORD )  )
 
Index: oce/src/OSD/OSD_Host.cxx
===================================================================
--- oce.orig/src/OSD/OSD_Host.cxx
+++ oce/src/OSD/OSD_Host.cxx
@@ -228,7 +228,9 @@ Standard_Integer OSD_Host::Error()const{
 
 #include <OSD_Host.hxx>
 
+#ifdef _MSC_VER
 #pragma comment( lib, "WSOCK32.LIB" )
+#endif
 
 void _osd_wnt_set_error ( OSD_Error&, OSD_WhoAmI, ... );
 
Index: oce/src/OSD/OSD_MemInfo.cxx
===================================================================
--- oce.orig/src/OSD/OSD_MemInfo.cxx
+++ oce/src/OSD/OSD_MemInfo.cxx
@@ -14,6 +14,10 @@
 // commercial license or contractual agreement.
 
 #if (defined(_WIN32) || defined(__WIN32__))
+  #if defined(__MINGW32__)
+    #define WIN32_WINNT 0x0500
+    #define WINVER 0x0500
+  #endif
   #include <windows.h>
   #include <winbase.h>
   #include <process.h>
Index: oce/src/OSD/OSD_Process.cxx
===================================================================
--- oce.orig/src/OSD/OSD_Process.cxx
+++ oce/src/OSD/OSD_Process.cxx
@@ -235,10 +235,6 @@ Standard_Integer OSD_Process::Error()con
 #include <stdint.h>
 #endif
 
-#ifdef _MSC_VER
-#pragma warning( disable : 4700 )
-#endif
-
 void _osd_wnt_set_error ( OSD_Error&, OSD_WhoAmI, ... );
 
 OSD_Process :: OSD_Process () {
Index: oce/src/Poly/Poly_CoherentNode.cxx
===================================================================
--- oce.orig/src/Poly/Poly_CoherentNode.cxx
+++ oce/src/Poly/Poly_CoherentNode.cxx
@@ -16,10 +16,6 @@
 #include <Poly_CoherentNode.hxx>
 #include <Poly_CoherentTriangle.hxx>
 
-#ifdef _MSC_VER
-#pragma warning(disable:4996)
-#endif
-
 #include <stdio.h>
 
 //=======================================================================
Index: oce/src/Poly/Poly_CoherentTriPtr.hxx
===================================================================
--- oce.orig/src/Poly/Poly_CoherentTriPtr.hxx
+++ oce/src/Poly/Poly_CoherentTriPtr.hxx
@@ -21,7 +21,7 @@
 
 class Poly_CoherentTriangle;
 
-#ifdef WNT
+#ifdef _MSC_VER
 #pragma warning (push)
 #pragma warning(disable:4355) //'this' : used in base member initializer list
 #endif
@@ -177,7 +177,7 @@ class Poly_CoherentTriPtr
   friend class Iterator;
 };
 
-#ifdef WNT
+#ifdef _MSC_VER
 #pragma warning (pop)
 #endif
 
Index: oce/src/Standard/Standard_Atomic.hxx
===================================================================
--- oce.orig/src/Standard/Standard_Atomic.hxx
+++ oce/src/Standard/Standard_Atomic.hxx
@@ -55,24 +55,20 @@ int Standard_Atomic_Decrement (volatile
   return __sync_sub_and_fetch (theValue, 1);
 }
 
-#elif defined(_MSC_VER) || defined(__BORLANDC__)
-#ifdef __BORLANDC__
-extern "C" {
-  __declspec(dllimport) long __stdcall InterlockedIncrement ( long volatile *lpAddend);
-  __declspec(dllimport) long __stdcall InterlockedDecrement ( long volatile *lpAddend);
- }
-#else
-extern "C" {
-  long _InterlockedIncrement (volatile long* lpAddend);
-  long _InterlockedDecrement (volatile long* lpAddend);
-}
-#endif
-
-#if defined(_MSC_VER)
-  // force intrinsic instead of WinAPI calls
-  #pragma intrinsic (_InterlockedIncrement)
-  #pragma intrinsic (_InterlockedDecrement)
-#endif
+#elif (defined(_WIN32) || defined(__WIN32__))
+  #ifdef _MSC_VER
+    extern "C" {
+      long _InterlockedIncrement(long volatile* lpAddend);
+      long _InterlockedDecrement(long volatile* lpAddend);
+    }
+  #else
+    extern "C" {
+      __declspec(dllimport) long __stdcall InterlockedIncrement ( long volatile *lpAddend);
+      __declspec(dllimport) long __stdcall InterlockedDecrement ( long volatile *lpAddend);
+    }
+    #define _InterlockedIncrement InterlockedIncrement
+    #define _InterlockedDecrement InterlockedDecrement
+  #endif
 
 // WinAPI function or MSVC intrinsic
 // Note that we safely cast int* to long*, as they have same size and endian-ness
Index: oce/src/TopExp/TopExp_Explorer.cxx
===================================================================
--- oce.orig/src/TopExp/TopExp_Explorer.cxx
+++ oce/src/TopExp/TopExp_Explorer.cxx
@@ -138,11 +138,6 @@ const TopoDS_Shape&  TopExp_Explorer::Cu
 //purpose  : 
 //=======================================================================
 
-#ifdef _MSC_VER
-#pragma warning(push)
-#pragma warning(disable: 4291) // to avoid warning when using new(buffer) syntax
-#endif
-
 void  TopExp_Explorer::Next()
 {
   Standard_Integer NewSize;
@@ -220,9 +215,6 @@ void  TopExp_Explorer::Next()
   hasMore = Standard_False;
 }
 
-#ifdef _MSC_VER
-#pragma warning(pop)
-#endif
 
 //=======================================================================
 //function : ReInit
Index: oce/src/ViewerTest/ViewerTest.cxx
===================================================================
--- oce.orig/src/ViewerTest/ViewerTest.cxx
+++ oce/src/ViewerTest/ViewerTest.cxx
@@ -70,7 +70,6 @@
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
 #pragma warning(4:4190)
-#pragma warning (disable:4996)
 #endif
 
 #include <NIS_InteractiveContext.hxx>
Index: oce/src/ViewerTest/ViewerTest_ObjectCommands.cxx
===================================================================
--- oce.orig/src/ViewerTest/ViewerTest_ObjectCommands.cxx
+++ oce/src/ViewerTest/ViewerTest_ObjectCommands.cxx
@@ -145,7 +145,6 @@
 
 #ifdef _MSC_VER
 # define _CRT_SECURE_NO_DEPRECATE
-# pragma warning (disable:4996)
 #endif
 
 extern ViewerTest_DoubleMapOfInteractiveAndName& GetMapOfAIS();
Index: oce/src/ViewerTest/ViewerTest_ViewerCommands.cxx
===================================================================
--- oce.orig/src/ViewerTest/ViewerTest_ViewerCommands.cxx
+++ oce/src/ViewerTest/ViewerTest_ViewerCommands.cxx
@@ -88,7 +88,6 @@
 
   #if defined(_MSC_VER)
     #define _CRT_SECURE_NO_DEPRECATE
-    #pragma warning (disable:4996)
   #endif
 #elif defined(__APPLE__) && !defined(MACOSX_USE_GLX)
   #include <Cocoa_Window.hxx>
Index: oce/src/VrmlData/VrmlData_Geometry.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_Geometry.cxx
+++ oce/src/VrmlData/VrmlData_Geometry.cxx
@@ -34,7 +34,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 #include <stdio.h>
Index: oce/src/VrmlData/VrmlData_Group.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_Group.cxx
+++ oce/src/VrmlData/VrmlData_Group.cxx
@@ -25,7 +25,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 #include <stdio.h>
Index: oce/src/VrmlData/VrmlData_IndexedFaceSet.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_IndexedFaceSet.cxx
+++ oce/src/VrmlData/VrmlData_IndexedFaceSet.cxx
@@ -31,7 +31,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 #include <stdio.h>
Index: oce/src/VrmlData/VrmlData_IndexedLineSet.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_IndexedLineSet.cxx
+++ oce/src/VrmlData/VrmlData_IndexedLineSet.cxx
@@ -26,7 +26,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 IMPLEMENT_STANDARD_HANDLE  (VrmlData_IndexedLineSet, VrmlData_Geometry)
Index: oce/src/VrmlData/VrmlData_Material.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_Material.cxx
+++ oce/src/VrmlData/VrmlData_Material.cxx
@@ -21,7 +21,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 #include <stdio.h>
Index: oce/src/VrmlData/VrmlData_Node.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_Node.cxx
+++ oce/src/VrmlData/VrmlData_Node.cxx
@@ -26,7 +26,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 IMPLEMENT_STANDARD_HANDLE  (VrmlData_Node, Standard_Transient)
Index: oce/src/VrmlData/VrmlData_Scene.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_Scene.cxx
+++ oce/src/VrmlData/VrmlData_Scene.cxx
@@ -45,7 +45,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 static void     dumpNode        (Standard_OStream&              theStream,
Index: oce/src/VrmlData/VrmlData_WorldInfo.cxx
===================================================================
--- oce.orig/src/VrmlData/VrmlData_WorldInfo.cxx
+++ oce/src/VrmlData/VrmlData_WorldInfo.cxx
@@ -19,7 +19,6 @@
 
 #ifdef _MSC_VER
 #define _CRT_SECURE_NO_DEPRECATE
-#pragma warning (disable:4996)
 #endif
 
 #include <stdio.h>
