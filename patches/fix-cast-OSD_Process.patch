From 82c8d84f585603e808692367a858400ba7c3d3d5 Mon Sep 17 00:00:00 2001
From: Matthew Dempsky <matthew@dempsky.org>
Date: Sat, 27 Aug 2011 19:32:12 -0700
Subject: [PATCH 1/3] pass NULL for timezone pointer to gettimeofday()

---
 src/OSD/OSD_Process.cxx |    3 +--
 1 files changed, 1 insertions(+), 2 deletions(-)

From 50515448432598c9576e0606bf8d444f0624a79a Mon Sep 17 00:00:00 2001
From: Matthew Dempsky <matthew@dempsky.org>
Date: Sat, 27 Aug 2011 19:34:37 -0700
Subject: [PATCH 2/3] eliminate bad cast by copying to local variable

---
 src/OSD/OSD_Process.cxx |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

From 58595af8246959cff40f06750c6da8d7c62eff8c Mon Sep 17 00:00:00 2001
From: Matthew Dempsky <matthew@dempsky.org>
Date: Sat, 27 Aug 2011 19:35:40 -0700
Subject: [PATCH 3/3] use localtime_r if available

---
 CMakeLists.txt          |    1 +
 src/OSD/OSD_Process.cxx |    4 ++++
 2 files changed, 5 insertions(+), 0 deletions(-)

Index: oce/src/OSD/OSD_Process.cxx
===================================================================
--- oce.orig/src/OSD/OSD_Process.cxx
+++ oce/src/OSD/OSD_Process.cxx
@@ -80,15 +80,19 @@ Quantity_Date  OSD_Process::SystemDate()
 Quantity_Date result;
 Standard_Integer month=0,day=0,year=0,hh=0,mn=0,ss=0;
 struct tm transfert;
+time_t secs;
 struct timeval tval;
-struct timezone tzone;
 int status;
 
- status = gettimeofday( &tval, &tzone );
+ status = gettimeofday( &tval, NULL );
  if (status == -1) myError.SetValue (errno, Iam, "GetSystem");
  else {
-  memcpy(&transfert, localtime((time_t *)&tval.tv_sec), sizeof(struct
-tm));
+  secs = tval.tv_sec;
+#ifdef HAVE_LOCALTIME_R
+  localtime_r(&secs, &transfert);
+#else
+  memcpy(&transfert, localtime(&secs), sizeof(struct tm));
+#endif
   month = transfert.tm_mon + 1;  // Add to January (month #1)
   day   = transfert.tm_mday;
   year  = transfert.tm_year;
