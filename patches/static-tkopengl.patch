From 1438143b50f3d4bcf123f0b47552f3a78077edfd Mon Sep 17 00:00:00 2001
From: Massimo Del Fedele <max@veneto.com>
Date: Sat, 24 Sep 2011 17:33:05 +0200
Subject: [PATCH 1/3] Make TKOpenGL work when building static libraries

(taken from OCC forum: http://www.opencascade.org/org/forum/thread_21868/)
---
 oce_build_config.h.cmake                     |    2 ++
 src/Graphic3d/Graphic3d_GraphicDevice.cxx    |   13 +++++++++++++
 src/Graphic3d/Graphic3d_WNTGraphicDevice.cxx |   13 +++++++++++++
 3 files changed, 28 insertions(+), 0 deletions(-)

From 8ec74388f72389ce08c0abcf5f28313264711b5f Mon Sep 17 00:00:00 2001
From: QbProg <tholag@gmail.com>
Date: Sat, 24 Sep 2011 17:34:33 +0200
Subject: [PATCH 2/3] Fix Win32 TKOpenGL build error when using static
 libraries

---
 inc/OpenGl_Extension.hxx |    9 ++++++---
 1 files changed, 6 insertions(+), 3 deletions(-)

Index: oce/inc/OpenGl_Extension.hxx
===================================================================
--- oce.orig/inc/OpenGl_Extension.hxx
+++ oce/inc/OpenGl_Extension.hxx
@@ -42,14 +42,17 @@
 # else
 #  define EXPORT
 # endif  /* DLL */
+#else
+# define EXPORT
+#endif  /* WNT */
+
+#if defined(WNT)
 # ifdef STRICT
 #  undef STRICT
 # endif
 # define STRICT
 # include <windows.h>
-#else
-# define EXPORT
-#endif  /* WNT */
+#endif
 
 #include <GL/gl.h>
 #include <GL/glu.h>
Index: oce/oce_build_config.h.cmake
===================================================================
--- oce.orig/oce_build_config.h.cmake
+++ oce/oce_build_config.h.cmake
@@ -270,3 +270,5 @@
 #cmakedefine OCE_DEFAULT_CSF_GraphicShr "@OCE_DEFAULT_CSF_GraphicShr@"
 #endif
 
+/* Whether OCE is build as shared lib */
+#cmakedefine OCE_BUILD_SHARED_LIB
Index: oce/src/Graphic3d/Graphic3d_GraphicDevice.cxx
===================================================================
--- oce.orig/src/Graphic3d/Graphic3d_GraphicDevice.cxx
+++ oce/src/Graphic3d/Graphic3d_GraphicDevice.cxx
@@ -126,6 +126,7 @@
 
 }
 
+#ifdef OCE_BUILD_SHARED_LIB
 void Graphic3d_GraphicDevice::SetGraphicDriver () {
 
 Standard_CString TheShr;
@@ -182,6 +183,18 @@
 	}
 
 }
+#else
+
+extern "C"
+{
+     Handle(Graphic3d_GraphicDriver) MetaGraphicDriverFactory(const Standard_CString AShrName);
+}
+
+void Graphic3d_GraphicDevice::SetGraphicDriver ()
+{
+     MyGraphicDriver = MetaGraphicDriverFactory("");
+}
+#endif
 
 #define BAD(x) (((x) == NULL) || (strlen((x)) <= 0))
 
Index: oce/src/Graphic3d/Graphic3d_WNTGraphicDevice.cxx
===================================================================
--- oce.orig/src/Graphic3d/Graphic3d_WNTGraphicDevice.cxx
+++ oce/src/Graphic3d/Graphic3d_WNTGraphicDevice.cxx
@@ -44,6 +44,7 @@
 
 }
 
+#ifdef OCE_BUILD_SHARED_LIB
 void Graphic3d_WNTGraphicDevice::SetGraphicDriver () 
 {
 
@@ -94,5 +95,17 @@
   }
 
 }
+#else
+
+extern "C"
+{
+     Handle(Graphic3d_GraphicDriver) MetaGraphicDriverFactory(const Standard_CString AShrName);
+}
+
+void Graphic3d_WNTGraphicDevice::SetGraphicDriver ()
+{
+     MyGraphicDriver = MetaGraphicDriverFactory("");
+}
+#endif
 
 #endif  // WNT
