SET(TOOLKIT_APP DRAWEXE)

SET(TOOLKIT_APP_MODULES
	DRAWEXE
)
SET(TOOLKIT_APP_LIBS
	TKDraw
	TKMesh
	TKGeomAlgo
	TKTopAlgo
	TKHLR
	TKGeomBase
	TKG2d
	TKBRep
	TKMath
	TKG3d
	TKernel
	TKService
)
IF(NOT OPENCASCADE_BUILD_SHARED_LIB AND NOT WIN32)
	SET(TOOLKIT_APP_LIBS ${TOOLKIT_APP_LIBS} ${CMAKE_DL_LIBS} )
ENDIF(NOT OPENCASCADE_BUILD_SHARED_LIB AND NOT WIN32)

MESSAGE(STATUS "Processing application: ${TOOLKIT_APP} (${TOOLKIT_APP_MODULES})")
SET(TOOLKIT_APP_SOURCE_FILES)
SET(TARGET_INCLUDE_DIRECTORIES)
FOREACH(MODULE ${TOOLKIT_APP_MODULES})
	# add all .cxx/*.c files or each module
	FILE(GLOB source_files
		${OpenCASCADE_SOURCE_DIR}/src/${MODULE}/*.cxx
		${OpenCASCADE_SOURCE_DIR}/src/${MODULE}/*.c
		${OpenCASCADE_SOURCE_DIR}/drv/${MODULE}/*.cxx
		${OpenCASCADE_SOURCE_DIR}/drv/${MODULE}/*.c)
	FILE(GLOB header_files
		${OpenCASCADE_SOURCE_DIR}/inc/Handle_${MODULE}*.hxx
		${OpenCASCADE_SOURCE_DIR}/inc/${MODULE}*.hxx
		${OpenCASCADE_SOURCE_DIR}/inc/Handle_${MODULE}*.h
		${OpenCASCADE_SOURCE_DIR}/inc/${MODULE}*.h
		${OpenCASCADE_SOURCE_DIR}/src/${MODULE}/*.hxx
		${OpenCASCADE_SOURCE_DIR}/src/${MODULE}/*.lxx
		${OpenCASCADE_SOURCE_DIR}/src/${MODULE}/*.gxx
		${OpenCASCADE_SOURCE_DIR}/src/${MODULE}/*.h
		${OpenCASCADE_SOURCE_DIR}/drv/${MODULE}/*.hxx
		${OpenCASCADE_SOURCE_DIR}/drv/${MODULE}/*.ixx
		${OpenCASCADE_SOURCE_DIR}/drv/${MODULE}/*.jxx
		${OpenCASCADE_SOURCE_DIR}/drv/${MODULE}/*.h)
	#MESSAGE(STATUS "${source_files}")
	FOREACH(module_source_file ${source_files})
		IF (WIN32)
			# For compilers under Windows a define must be set per file to correctly set the export macro
			SET_SOURCE_FILES_PROPERTIES(${module_source_file} PROPERTIES COMPILE_FLAGS "-D__${MODULE}_DLL")
		ENDIF(WIN32)
	ENDFOREACH(module_source_file ${source_files})

	# append these source files to the list of source files of the toolkit
	SET(TOOLKIT_APP_SOURCE_FILES ${TOOLKIT_APP_SOURCE_FILES} ${source_files}) 
	# required include paths
	SET(TARGET_INCLUDE_DIRECTORIES 
		"${TARGET_INCLUDE_DIRECTORIES} -I${OpenCASCADE_SOURCE_DIR}/src/${MODULE} -I${OpenCASCADE_SOURCE_DIR}/drv/${MODULE} ")
ENDFOREACH(MODULE ${TOOLKIT_APP_MODULES})
ADD_EXECUTABLE(${TOOLKIT_APP} ${TOOLKIT_APP_SOURCE_FILES})
SET_TARGET_PROPERTIES(${TOOLKIT_APP} PROPERTIES
	COMPILE_FLAGS "${TARGET_INCLUDE_DIRECTORIES}"
	INSTALL_RPATH "${OpenCASCADE_INSTALL_LIB_DIR};${OpenCASCADE_INSTALL_PACKAGE_LIB_DIR}"
)
# Set dependencies for thit ToolKit
LIST(REMOVE_DUPLICATES TOOLKIT_APP_LIBS)
TARGET_LINK_LIBRARIES(${TOOLKIT_APP} ${TOOLKIT_APP_LIBS} ${WIN32_LIBS})

#  Those are private libraries
INSTALL(TARGETS ${TOOLKIT_APP}
	RUNTIME DESTINATION ${OpenCASCADE_INSTALL_BIN_DIR}         COMPONENT RuntimeLibraries
	LIBRARY DESTINATION ${OpenCASCADE_INSTALL_PACKAGE_LIB_DIR} COMPONENT RuntimeLibraries
	ARCHIVE DESTINATION ${OpenCASCADE_INSTALL_PACKAGE_LIB_DIR} COMPONENT Development
)

